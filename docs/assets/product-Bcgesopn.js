import{i as $,r as t,b as T,j as e,M as q,k as A,l as b,Z as M,m as Z,n as F,o as Q}from"./vendor-react-DD8gH1fO.js";import{N as v,B as c}from"./navigation-DK1LkUim.js";import{B as N}from"./back-button-Daeb0khH.js";import{u as U,L as y}from"./index-Bx21NJoI.js";import{g as Y}from"./staticData-BQiDjMPt.js";function _({product:i}){const[n,o]=t.useState(!1),[u,h]=t.useState(""),[l,f]=t.useState({}),[m,w]=t.useState({}),j=[i.image,...i.gallery||[]],[C,a]=b(),[G,d]=b({containScroll:"keepSnaps",dragFree:!0}),[S,k]=t.useState(!1),[P,I]=t.useState(!1),[g,p]=t.useState(0),z=t.useCallback(()=>{a&&a.scrollPrev()},[a]),E=t.useCallback(()=>{a&&a.scrollNext()},[a]),B=t.useCallback(r=>{a&&(a.scrollTo(r),p(r))},[a]),x=t.useCallback(()=>{!a||!d||(p(a.selectedScrollSnap()),k(a.canScrollPrev()),I(a.canScrollNext()))},[a,d]);t.useEffect(()=>{a&&(x(),a.on("select",x),a.on("reInit",x))},[a,x]),t.useEffect(()=>{d&&d.scrollTo(g)},[g,d]);const L=r=>{f(s=>({...s,[r]:!0}))},R=r=>{w(s=>({...s,[r]:!0}))};return e.jsxs("div",{className:"space-y-4 overflow-hidden",children:[e.jsxs("div",{className:"relative overflow-hidden will-change-transform",ref:C,children:[e.jsx("div",{className:"flex aspect-[5/7]",children:j.map((r,s)=>e.jsxs("div",{className:"flex-[0_0_100%] min-w-0 relative",children:[!l[s]&&!m[s]&&e.jsx("div",{className:"absolute inset-0 bg-gray-50 flex items-center justify-center",children:e.jsx(y,{size:"lg"})}),m[s]&&e.jsx("div",{className:"absolute inset-0 bg-transparent flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"Image unavailable"})}),e.jsx("img",{src:r,alt:`${i.ProductName} view ${s+1}`,className:`w-full h-full object-cover transition-opacity duration-300 ${l[s]?"opacity-100":"opacity-0"}`,loading:s===0?"eager":"lazy",decoding:"async",fetchPriority:s===0?"high":"auto",onLoad:()=>L(s),onError:()=>R(s),sizes:"(max-width: 768px) 100vw, 50vw"}),e.jsx(c,{size:"icon",variant:"outline",className:"absolute top-4 right-4 bg-white/80 backdrop-blur-sm",onClick:()=>{h(r),o(!0)},children:e.jsx(M,{className:"h-4 w-4"})})]},s))}),e.jsx("div",{className:"absolute inset-y-0 left-0 hidden md:flex items-center",children:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full bg-white/80 backdrop-blur-sm -ml-4 hover:bg-white transform transition-transform hover:scale-105",onClick:z,disabled:!S,children:e.jsx(Z,{className:"h-4 w-4"})})}),e.jsx("div",{className:"absolute inset-y-0 right-0 hidden md:flex items-center",children:e.jsx(c,{variant:"ghost",size:"icon",className:"h-8 w-8 rounded-full bg-white/80 backdrop-blur-sm -mr-4 hover:bg-white transform transition-transform hover:scale-105",onClick:E,disabled:!P,children:e.jsx(F,{className:"h-4 w-4"})})})]}),j.length>1&&e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"flex gap-1 overflow-x-auto pb-2 scrollbar-hide max-w-full",children:j.map((r,s)=>e.jsx("button",{className:`aspect-square border-2 transition-all overflow-hidden flex-shrink-0 w-24 ${s===g?"border-primary ring-2 ring-primary/20":"border-gray-200 hover:border-gray-300"}`,style:{borderRadius:0,backgroundColor:"transparent"},onClick:()=>B(s),children:e.jsx("img",{src:r,alt:`${i.ProductName} thumbnail ${s+1}`,className:"w-full h-full object-cover",style:{borderRadius:0},loading:"lazy",decoding:"async",fetchPriority:"low",sizes:"96px"})},s))})}),n&&e.jsx("div",{className:"fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative max-w-[90vw] max-h-[90vh]",children:[e.jsx(c,{size:"icon",variant:"outline",className:"absolute top-4 right-4 bg-white z-10",onClick:()=>o(!1),children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx("img",{src:u,alt:i.ProductName,className:"max-w-full max-h-full object-contain",loading:"eager"})]})})]})}function V(){const{id:i}=$(),[n,o]=t.useState(1),{addToCart:u}=U(),h=()=>Y(Number(i)),{data:l,isLoading:f}=T({queryKey:[`/api/products/${i}`],queryFn:h});if(t.useEffect(()=>{window.scrollTo(0,0)},[]),f)return e.jsxs("div",{className:"min-h-screen",children:[e.jsx(v,{}),e.jsx(N,{}),e.jsx("div",{className:"container mx-auto px-4 pt-60 pb-32",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{size:"lg"}),e.jsx("p",{className:"mt-4 text-sm text-gray-500 font-light",children:"Загрузка товара..."})]})})})]});if(!l)return e.jsxs("div",{className:"min-h-screen",children:[e.jsx(v,{}),e.jsx(N,{}),e.jsx("div",{className:"container mx-auto px-4 pt-60 pb-32",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Product not found"})})]});const m=()=>{u({productId:l.id,quantity:n})};return e.jsxs("div",{className:"min-h-screen",children:[e.jsx(v,{}),e.jsx(N,{}),e.jsx("div",{className:"container mx-auto px-4 pt-60 pb-32",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8 max-w-6xl mx-auto",children:[e.jsx("div",{className:"order-1",children:e.jsx(_,{product:l})}),e.jsxs("div",{className:"order-2 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:l.ProductName}),e.jsxs("p",{className:"text-2xl font-semibold text-primary",children:["BYN ",l.priceBYN," / RUB ",l.priceRUB]})]}),e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"text-muted-foreground whitespace-pre-line",children:l.description})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(c,{variant:"outline",size:"icon",onClick:()=>o(Math.max(1,n-1)),disabled:n<=1,children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx("span",{className:"w-12 text-center font-semibold",children:n}),e.jsx(c,{variant:"outline",size:"icon",onClick:()=>o(n+1),children:e.jsx(A,{className:"h-4 w-4"})})]})}),e.jsx(c,{className:"w-full py-6 text-lg font-semibold text-white border-0",style:{backgroundColor:"#ec4899"},onClick:m,children:"Добавить в корзину"})]})]})})]})}export{V as default};
